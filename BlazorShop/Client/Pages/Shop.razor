@page "/shop"
@using Microsoft.AspNetCore.SignalR.Client
@using BlazorShop.Shared
@using BlazorShop.Client
@inject NavigationManager NM
@inject Blazored.LocalStorage.ISyncLocalStorageService LS


<h1>Shop</h1>

<button class="btn btn-primary" @onclick="PrikaziArtikle">Artikli</button>

<div>
    <ul>
        @foreach (Artikal art in lArt)
        {
            <li><button class="btn btn-primary" @onclick="(()=>DodajUKorpu(art))">+</button> @art</li>
        }
    </ul>
</div>


<h2>Izabrali ste:</h2>

<div>
    <ul>
        @foreach (Artikal art in IzabraniArtikal)
        {
        <li>@art</li>
        }
    </ul>
</div>


@code {

    public HubConnection ShopServer;
    public List<Artikal> lArt = new List<Artikal>();
    public List<Artikal> IzabraniArtikal = new List<Artikal>();

    public decimal UkupnaCena { get; set; } = 0;
    Artikal art = new Artikal();

    protected override async Task OnInitializedAsync()
    {

        ShopServer= new HubConnectionBuilder().WithUrl(NM.ToAbsoluteUri("/habshop")).Build();


        ShopServer.On<List<Artikal>>("ArtikalMetoda", lart =>

        {
            lArt = lart;
            StateHasChanged();
        });

        await ShopServer.StartAsync();

    }

    public void  PrikaziArtikle()
    {
        ShopServer.SendAsync("SviArtikli");
    }


    public void DodajUKorpu(Artikal a)
    {
        IzabraniArtikal.Add(a);

       LS.SetItem("CuvajKorpu", IzabraniArtikal);

    }




}
